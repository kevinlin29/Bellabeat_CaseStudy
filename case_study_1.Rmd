---
title: "Bellabeat Data Analysis Case Study"
author: "Kevin Lin"
date: "11/10/2021 - 14/10/2021"
output: 
  html_document:
    toc: true
    toc_float: true
    theme : united
    toc_depth: 4
---

<style type="text/css">
  body{
  font-size: 12pt;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 1. Introduction

Bellabeat, a high-tech manufacturer of health-focused products for women, is a small but successful company with the potential of becoming a large paler in the global smart device market. They offer different smart devices which collects data on sleep, activity, stress, menstrual cycles, and mindfulness habits with the goal of helping users better understand their habits and make healthy decisions

The goal of this case study is to analyze smart device fitness data, which would yield new viable growth opportunities for the company. 


## 2. Key Questions:

1. What are some trends in smart device usage?
2. How could these trends apply to Bellabeat customers?
3. How could these trends help influence Bellabeat marketing strategy?

### 2.1 Stakeholders
* **Urška Sršen**: Bellabeat’s cofounder and Chief Creative Officer  

* **Sando Mur**: Mathematician and Bellabeat’s cofounder; key member of the Bellabeat executive team

* **Bellabeat marketing analytics team**: A team of data analysts responsible for collecting, analyzing, and reporting data that helps guide Bellabeat’s marketing strategy.

## 3. Preparation

### 3.1 Data Source - Public:
* [FitBit Fitness Tracker Data](https://www.kaggle.com/arashnic/fitbit) (CC0: Public Domain, dataset made available through Mobius)
  * Kaggle Data Set - personal fitness tracker from thirty fitbit users
* Used Data Sets
  * hourlyCalories_merged.csv
  * hourlySteps_merged.csv
  * dailyActivity_merged.csv
  * sleepDay_merged.csv
  
### 3.2 Privacy and Consent   
These datasets were generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016-05.12.2016. Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring.

### 3.3 Potential Issues with Dataset
The data only includes 33 people which is an extremely small sample from the population that uses these smart devices. In addition, not all 33 users data is available in each file. Thus this introduces a high chance of sampling bias into our analysis.

The data was collected in 2016, thus the data is quite dated, and the habit of people using health trackers have changed significantly, thus the accuracy of the sample is likely going to be higher with current data.

### 3.4 Setting up R for Data Processing
#### 3.4.1 Loading Packages
```{r loading_packages, message=FALSE}
library(tidyverse)
library(here)
library(skimr)
library(janitor)
library(ggplot2)
library(lubridate)
library(ggpubr)
```

#### 3.4.2 Importing Data into R
```{r loading_datasets}
hourly_Step <- read.csv("hourlySteps_merged.csv")
daily_Activity <- read.csv("dailyActivity_merged.csv")
daily_Sleep <- read.csv("sleepDay_merged.csv")
```
#### 3.4.3 Preview Data Structure
```{r}
str(hourly_Step)
str(daily_Activity)
str(daily_Sleep)
```

## 4. Processing Data
### 4.1 Cleaning
#### 4.1.1 Data Completeness 
First we have to check if each data set contains all the 33 users, and we see that the daily_Sleep data set only contain 24
```{r, message=FALSE}
n_unique(hourly_Step$Id)
n_unique(daily_Activity$Id)
n_unique(daily_Sleep$Id)
```

#### 4.1.2 Checking any duplicates
Next, check if we have any duplicated data within our data set, which we see 3 in the daily_Sleep table
```{r, message=FALSE}
sum(duplicated(hourly_Step))
sum(duplicated(daily_Activity))
sum(duplicated(daily_Sleep))
```

#### 4.1.3 Remove duplicates
Remove the duplicated data, and verify if everything is correct
```{r}
daily_Sleep <- daily_Sleep %>%
  distinct() %>%
  drop_na()

sum(duplicated(daily_Sleep))
```

#### 4.1.4 Cleaning and Formating
Clean the names of the data, format all the columns to lowercase, and then match the time format for combination of dataset in the next step
```{r clean_names,echo=T, results='hide'}
clean_names(hourly_Step)
clean_names(daily_Activity)
clean_names(daily_Sleep)

hourly_Step <- rename_with(hourly_Step, tolower)
daily_Activity <- rename_with(daily_Activity, tolower)
daily_Sleep <- rename_with(daily_Sleep, tolower)

hourly_Step<- hourly_Step %>% 
  rename(date_time = activityhour) %>% 
  mutate(date_time = as.POSIXct(date_time,format ="%m/%d/%Y %I:%M:%S %p" ))

daily_Activity <- daily_Activity %>%
  rename(date = activitydate) %>%
  mutate(date = as_date(date, format = "%m/%d/%Y"))

daily_Sleep <- daily_Sleep %>%
  rename(date = sleepday) %>%
  mutate(date = as_date(date,format ="%m/%d/%Y %I:%M:%S %p"))
```
#### 4.1.5 Verifying Data
Checking the updated data set
```{r}
head(hourly_Step)
head(daily_Activity)
head(daily_Sleep)
```

### 4.2 Merging Data
Next, we will merge the data set together for easier analysis in the future steps. The daily activity includes daily steps and calories, which would make for interesting analysis.

```{r}
daily_Activity_Sleep <- merge(daily_Activity, daily_Sleep, by=c ("id", "date"))
glimpse(daily_Activity_Sleep)
```


### 4.3 Organizing Data

Organize the average user step, calories, sleep per day

```{r}
average <- daily_Activity_Sleep %>%
  group_by(id) %>%
  summarise(avg_step_daily = mean(totalsteps), avg_cal_daily = mean(calories), avg_sleep_daily = mean(totalminutesasleep))
str(average)
```

Create columns for weekly data, which will be used during analysis

```{r}
average <- average %>%
  mutate(avg_step_weekly = avg_step_daily*7, avg_cal_weekly = avg_cal_daily*7, avg_sleep_weekly =avg_sleep_daily*7)

str(average)
```

Next, we can categorize each user into different type, according to their averge steps per day.

We will follow such guild lines for categorizing the data

* Active 1: less than 5,999 steps per day
* Active 2: 6,000 to 9,999 steps per day
* Active 3: more than 10,000 steps per day

```{r}
distribution <- average %>%
  mutate(active_level = case_when(
    avg_step_daily < 5999 ~ "Low Active",
    avg_step_daily >= 6000 & avg_step_daily < 9999 ~ "Active",
    avg_step_daily >= 10000 ~ "High Active"
  )) %>%
  mutate(sleep_level = case_when(
    avg_sleep_daily/60 <7 ~ "Low Sleep Time",
    avg_sleep_daily/60 >= 7 & avg_sleep_daily/60 < 9 ~ "Average Sleep Time",
    avg_sleep_daily/60 >= 9 ~ "High Sleep Time",
  ))
str(distribution)
```


## 5. Analyze
For the analysis, we are going to see if there is a pattern between the following

* Weekly Steps vs Weekly Sleep
* Daily Calories vs Daily Sleep
* Weekly Activity vs Weekly Calories

In addition, we will be analyzing the user's habit of smart wearables, and conclude our findings

### 5.1 Daily Correlations

We want to look at if there is any correlation between steps, sleeps, and calories burned.

```{r user_correlation}

p1 <- ggplot(daily_Activity_Sleep, aes(x=totalsteps, y=totalminutesasleep))+
        geom_jitter() +
        geom_smooth(color = "blue")+
        labs(x = "Daily Steps", y = "Time Asleep")+
        ggtitle("Steps vs Sleep")+
        theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

p2 <- ggplot(daily_Activity_Sleep, aes(x=calories, y=totalminutesasleep))+
        geom_jitter() +
        geom_smooth(color = "blue")+
        labs(x = "Daily Calories", y = "Time Asleep")+
        ggtitle("Calories vs Sleep")+
        theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

p3 <- ggplot(daily_Activity_Sleep, aes(x=totalsteps, y=calories))+
        geom_jitter() +
        geom_smooth(color = "blue")+
        labs(x = "Daily Steps", y = "Daily Calories")+
        ggtitle("Steps vs Calories")+
        theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

ggarrange(p1, p2, p3, ncol = 3, nrow = 1)
```

As we can see, there like likely zero correlation between amount of steps and sleep time, as well as calories burned and sleep time. But on the other hand, we see a moderate positive correlation between amounts of steps and calories burned, which is to be expected.

### 5.2 Active Level
```{r user_active_distribution}
usr_active_dis <- distribution %>%
  group_by(active_level) %>%
  summarise(total = n()) %>%
  mutate(total1 = sum(total)) %>%
  group_by(active_level) %>%
  summarise(total_percent = total / total1) %>%
  mutate(labels = scales::percent(total_percent))



head(usr_active_dis)

dis_plot <- ggplot(usr_active_dis, aes(x="", y=total_percent, fill=active_level))+
  geom_bar(width=1,stat="identity")+
  coord_polar("y", start=0)+
  scale_fill_brewer(palette="Blues", direction=-1)+
  theme_minimal()+
  theme(axis.text.x=element_blank(),
        axis.title.y = element_blank(),
        panel.border = element_blank(),
        panel.grid=element_blank(),
        axis.ticks = element_blank(),
        plot.title=element_text(size=14, face="bold", hjust = 0.5)
        )+
  geom_text(aes(label = labels), position = position_stack(vjust = 0.5))+
  labs(title="User Active Level Distribution", x="", y="")

dis_plot
```


### 5.3 Sleep Level
```{r user_sleep_distribution}
usr_sleep_dis <- distribution %>%
  group_by(sleep_level)%>%
  summarise(total=n())%>%
  mutate(total1=sum(total))%>%
  group_by(sleep_level)%>%
  summarise(total_percent = total/total1)%>%
  mutate(labels = scales::percent(total_percent))

head(usr_sleep_dis)

sleep_plot <- ggplot(usr_sleep_dis, aes(x="", y=total_percent, fill=sleep_level))+
  geom_bar(width=1,stat="identity")+
  coord_polar("y", start=0)+
  scale_fill_brewer(palette="Blues", direction=-1)+
  theme_minimal()+
  theme(axis.text.x=element_blank(),
        axis.title.y = element_blank(),
        panel.border = element_blank(),
        panel.grid=element_blank(),
        axis.ticks = element_blank(),
        plot.title=element_text(size=14, face="bold", hjust = 0.5)
        )+
  geom_text(aes(label = labels), position = position_stack(vjust = 0.5))+
  labs(title="User Sleep Level Distribution", x="", y="")

sleep_plot

```

### 5.4 Device Wear Time

```{r}
usr_use <- daily_Activity_Sleep %>%
  group_by(id) %>%
  summarize(days_used=sum(n())) %>%
  mutate(usage = case_when(
    days_used >= 1 & days_used <= 5 ~ "Low Wear Time",
    days_used >= 6 & days_used <= 23 ~ "Moderate Wear Time", 
    days_used >= 24 & days_used <= 31 ~ "High Wear Time", 
  ))
  
head(usr_use)

usr_wear_dis <- usr_use %>%
  group_by(usage)%>%
  summarise(total=n())%>%
  mutate(total1=sum(total))%>%
  group_by(usage)%>%
  summarise(total_percent = total/total1)%>%
  mutate(labels = scales::percent(total_percent))

head(usr_wear_dis)

wear_plot <- ggplot(usr_wear_dis, aes(x="", y=total_percent, fill=usage))+
  geom_bar(width=1,stat="identity")+
  coord_polar("y", start=0)+
  scale_fill_brewer(palette="Blues", direction=-1)+
  theme_minimal()+
  theme(axis.text.x=element_blank(),
        axis.title.y = element_blank(),
        panel.border = element_blank(),
        panel.grid=element_blank(),
        axis.ticks = element_blank(),
        plot.title=element_text(size=14, face="bold", hjust = 0.5)
        )+
  geom_text(aes(label = labels), position = position_stack(vjust = 0.5))+
  labs(title="User Device Wear Time Distribution", x="", y="")

wear_plot
```


## 6. Suggestions

Now is a time to look back at the Business tasks to provide a suggestion that would match Bellabeat's vision.

### Introduce a Reward System

According to our studies, we found that nearly a third of the population are having activity levels which are lower than suggested of around 10,000 steps. In this case, we can introduce the reward system for giving prizes or badges for completing such task. This reward system would apply to all catagories including active levels, sleep levels, and how often the user wears the device.

### Sleep Reminder

From the above discoveries, we find that sleep is a category where the data shows the most lack of, as in lack of sleep time. Over half of the population are receiving less than 7 hours of sleep, which is below the recommended amount of around 8 hours. In this case, we can send out a reminder at a time where it will let the user know how to get the healthy and correct amount of sleep for the night.

### Active Alert

We can also introduce an active alert, telling the user to get the healthy amount of activity in within the day, and simply stand for a bit after sitting down for too long, which are both beneficial for the human body in the long run.


